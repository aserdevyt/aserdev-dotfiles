#!/bin/bash

# Usage: ./install [--silent]
# Merges files and directories from this workspace into the user's home directory (~).
# If a file/directory exists in ~, it will be replaced after confirmation (unless --silent is used).

SILENT=0
if [[ "$1" == "--silent" ]]; then
	SILENT=1
fi

WORKSPACE_DIR="$(cd "$(dirname "$0")" && pwd)"
HOME_DIR="$HOME"

for ITEM in "$WORKSPACE_DIR"/*; do
	BASENAME="$(basename "$ITEM")"
	TARGET="$HOME_DIR/$BASENAME"
	# Skip the install script itself
	if [[ "$BASENAME" == "install" ]]; then
		continue
	fi
	if [[ -e "$TARGET" ]]; then
		if [[ $SILENT -eq 0 ]]; then
			read -p "Replace $TARGET? [y/N]: " RESP
			if [[ ! "$RESP" =~ ^[Yy]$ ]]; then
				echo "Skipping $BASENAME"
				continue
			fi
		fi
		if [[ -d "$TARGET" && ! -L "$TARGET" ]]; then
			rm -rf "$TARGET"
		else
			rm -f "$TARGET"
		fi
	fi
	if [[ -d "$ITEM" && ! -L "$ITEM" ]]; then
		cp -r "$ITEM" "$TARGET"
	else
		cp "$ITEM" "$TARGET"
	fi
	echo "Installed $BASENAME to $HOME_DIR"
done
