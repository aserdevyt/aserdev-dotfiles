#!/usr/bin/env bash
# ğŸ§  aserdev's Rofi Control Center v5.5 â€” "Screenshot Copy Edition"

TERMINAL="kitty" # change if u use another terminal

# ğŸ’¬ Function to auto-install missing apps
ask_install() {
  app="$1"
  bin="${2:-$1}" # allows checking a different binary name
  if ! command -v "$bin" &>/dev/null; then
    ans=$(printf "Yes\nNo" | rofi -dmenu -p "$app not found. Install?")
    if [[ "$ans" == "Yes" ]]; then
      if command -v yay &>/dev/null; then
        $TERMINAL -e bash -c "yay -S $app; read -p 'Press enter to exit...'"
      else
        $TERMINAL -e bash -c "sudo pacman -S $app --noconfirm; read -p 'Press enter to exit...'"
      fi
    else
      rofi -e "Skipping installation of $app."
      return 1
    fi
  fi
}

# âš™ï¸ Settings Menu
settings_menu() {
  options=(
    "ğŸŒ€  Hyprland"
    "ğŸ§­  Waybar"
    "ğŸ›ï¸  Rofi"
    "ğŸ–¼ï¸  Wallpaper"
    "â¬…ï¸  Back"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "Settings")

  case "$choice" in
    "ğŸŒ€  Hyprland") thunar ~/.config/hypr & ;;
    "ğŸ§­  Waybar")
      thunar ~/.config/waybar &
      wait $!
      pkill -SIGUSR2 waybar && notify-send "âœ… Waybar Reloaded" "Changes applied successfully"
      ;;
    "ğŸ›ï¸  Rofi") thunar ~/.config/rofi & ;;
    "ğŸ–¼ï¸  Wallpaper") waypaper --open & ;;
    "â¬…ï¸  Back") main_menu ;;
  esac
}

# ğŸ“¦ Install Menu
install_menu() {
  options=(
    "ğŸ—ï¸  AUR (yay)"
    "ğŸ“¦  Pacman"
    "ğŸ“¦  Flatpak"
    "ğŸ”„  Update All"
    "â¬…ï¸  Back"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "Install")

  case "$choice" in
    "ğŸ—ï¸  AUR (yay)")
      pkg=$(rofi -dmenu -p "AUR package:")
      [ -n "$pkg" ] && $TERMINAL -e bash -c "yay -S $pkg; read -p 'Press enter to exit...'"
      ;;
    "ğŸ“¦  Pacman")
      pkg=$(rofi -dmenu -p "Pacman package:")
      [ -n "$pkg" ] && $TERMINAL -e bash -c "sudo pacman -S $pkg; read -p 'Press enter to exit...'"
      ;;
    "ğŸ“¦  Flatpak")
      pkg=$(rofi -dmenu -p "Flatpak package:")
      [ -n "$pkg" ] && $TERMINAL -e bash -c "flatpak install -y $pkg; read -p 'Press enter to exit...'"
      ;;
    "ğŸ”„  Update All")
      $TERMINAL -e bash -c '
        echo "Updating system..."; 
        sudo pacman -Syu --noconfirm;
        flatpak update -y;
        if command -v yay &>/dev/null; then yay -Syu --noconfirm; fi;
        echo "âœ… All updates done!"; 
        read -p "Press enter to exit..."
      '
      ;;
    "â¬…ï¸  Back") main_menu ;;
  esac
}

# ğŸ“‹ Clipboard Menu
clipboard_menu() {
  options=(
    "ğŸ“‹  Open Clipboard History"
    "ğŸ§¹  Clear Clipboard History"
    "â¬…ï¸  Back"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "Clipboard")

  case "$choice" in
    "ğŸ“‹  Open Clipboard History") rofi-cliphist ;;
    "ğŸ§¹  Clear Clipboard History") cliphist wipe && notify-send "ğŸ§¹ Clipboard Cleared" ;;
    "â¬…ï¸  Back") main_menu ;;
  esac
}

# ğŸ“¸ Screenshot / Record Menu
# ğŸ“¸ Screenshot / Record Menu
screenshot_menu() {
  options=(
    "ğŸ–¥ï¸  Screenshot Screen"
    "ğŸŸ©  Screenshot Area"
    "ğŸ¥  Screen Record (OBS)"
    "â¬…ï¸  Back"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "Screenshot / Record")

  case "$choice" in
    "ğŸ–¥ï¸  Screenshot Screen")
      ask_install "grimblast" || return
      grimblast copysave screen --notify
      notify-send "ğŸ“¸ Screenshot Taken!" "Full screen saved + copied âœ…"
      ;;
    "ğŸŸ©  Screenshot Area")
      ask_install "grimblast" || return
      grimblast copysave area --notify
      notify-send "ğŸ“¸ Screenshot Taken!" "Area saved + copied âœ…"
      ;;
    "ğŸ¥  Screen Record (OBS)")
      # fix check for obs binary, not obs-studio
      if ! command -v obs &>/dev/null; then
        ans=$(printf "Yes\nNo" | rofi -dmenu -p "OBS not found. Install?")
        if [[ "$ans" == "Yes" ]]; then
          if command -v yay &>/dev/null; then
            $TERMINAL -e bash -c "yay -S obs-studio; read -p 'Press enter to exit...'"
          else
            $TERMINAL -e bash -c "sudo pacman -S obs-studio --noconfirm; read -p 'Press enter to exit...'"
          fi
        else
          rofi -e "Skipping OBS installation."
          return
        fi
      fi
      obs & disown
      ;;
    "â¬…ï¸  Back") main_menu ;;
  esac
}

# ğŸ§  System Info Menu
sysinfo_menu() {
  options=(
    "ğŸ§   Brokefetch"
    "âš¡  Fastfetch"
    "ğŸ“Š  Btop"
    "â¬…ï¸  Back"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "System Info")

  case "$choice" in
    "ğŸ§   Brokefetch")
      if command -v brokefetch &>/dev/null; then
        $TERMINAL -e bash -c "brokefetch; echo ''; read -p 'Press enter to exit...'"
      else
        ans=$(printf "Install\nOpen GitHub" | rofi -dmenu -p "Brokefetch not found")
        [[ "$ans" == "Install" ]] && ask_install "brokefetch"
        [[ "$ans" == "Open GitHub" ]] && xdg-open "https://github.com/Szerwigi1410/brokefetch" &
      fi
      ;;
    "âš¡  Fastfetch")
      ask_install "fastfetch" || return
      $TERMINAL -e bash -c "fastfetch; echo ''; read -p 'Press enter to exit...'"
      ;;
    "ğŸ“Š  Btop")
      ask_install "btop" || return
      $TERMINAL -e bash -c "btop; echo ''; read -p 'Press enter to exit...'"
      ;;
    "â¬…ï¸  Back") main_menu ;;
  esac
}

# ğŸ  Main Menu
main_menu() {
  options=(
    "âš™ï¸  Settings"
    "ğŸš€  Run Command"
    "ğŸ“¦  Install"
    "ğŸ“‹  Clipboard"
    "ğŸ˜€  Emoji Picker"
    "ğŸ“¸  Screenshot / Record"
    "ğŸ§   System Info"
    "ğŸ”‹  Power"
    "â„¹ï¸  About"
  )
  choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu -i -p "Aser Control Center")

  case "$choice" in
    "âš™ï¸  Settings") settings_menu ;;
    "ğŸš€  Run Command") rofi -show run ;;
    "ğŸ“¦  Install") install_menu ;;
    "ğŸ“‹  Clipboard") clipboard_menu ;;
    "ğŸ˜€  Emoji Picker") rofi -show emoji ;;
    "ğŸ“¸  Screenshot / Record") screenshot_menu ;;
    "ğŸ§   System Info") sysinfo_menu ;;
    "ğŸ”‹  Power") wlogout ;;
    "â„¹ï¸  About") rofi -e "Made by aserdev ğŸ’» Arch btw ğŸ¦¦ website: https://aserdevyt.github.io/
TYSM: hyprland, wayland, archlinux, waybar, rofi-wayland, rofi-emoji, pluma, grimblast, aur, yay, brokefetch" ;;
  esac
}

# ğŸš€ Start it up
main_menu

